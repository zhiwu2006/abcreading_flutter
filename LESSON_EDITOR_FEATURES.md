# 课程编辑器功能说明

## 界面布局优化
- **课程列表优先**: 将课程列表移到页面顶部，方便用户首先查看现有课程
- **导入功能后置**: 将导入功能放在下方，符合"查看-管理-导入"的使用流程
- **空状态提示**: 当没有课程时，提示用户使用下方导入功能

## 数据库同步功能

### 1. 同步按钮
- **工具栏同步**: 右上角云同步图标，可快速访问同步功能
- **列表区同步**: 课程列表标题下方的"同步数据库"按钮
- **双向同步**: 支持上传本地到数据库和从数据库下载到本地

### 2. 同步操作
- **上传到数据库**: 将本地编辑的课程数据同步到远程数据库
- **从数据库下载**: 将远程数据库的课程同步到本地缓存
- **智能提示**: 操作完成后提醒用户使用同步功能

### 3. 工作流程
1. **本地编辑**: 导入、删除课程等操作先在本地缓存中进行
2. **批量同步**: 编辑完成后，使用同步按钮一次性上传所有更改
3. **数据一致性**: 确保本地和远程数据库保持同步

## 多选编辑功能

### 1. 多选模式
- 点击右上角的复选框图标进入/退出多选模式
- 在多选模式下，课程列表项前会显示复选框
- 点击课程项或复选框可以选择/取消选择课程

### 2. 批量操作
- **全选**: 点击工具栏的全选按钮选择所有课程
- **清除选择**: 点击清除按钮取消所有选择
- **批量删除**: 选择课程后点击删除按钮批量删除
- **批量导出**: 选择课程后点击导出按钮，将选中课程的JSON数据复制到剪贴板

### 3. 界面优化
- 选中的课程会有蓝色背景高亮显示
- 右上角显示已选择课程数量
- 底部操作栏显示批量操作按钮（仅在有选择时显示）
- 工具栏根据模式动态显示相关按钮

### 4. 使用流程
1. 点击右上角复选框图标进入多选模式
2. 点击课程项或复选框选择需要操作的课程
3. 使用工具栏或底部操作栏进行批量操作
4. 完成后点击复选框图标退出多选模式

### 5. 功能特点
- 支持单选和多选
- 实时显示选择状态和数量
- 批量操作前会有确认对话框
- 导出的JSON格式与导入格式兼容
- 操作完成后会显示成功提示

## 课程详情编辑功能

### 1. 详情页面访问
- **点击进入**: 在非多选模式下点击课程列表项进入详情编辑
- **完整编辑**: 支持编辑课程的所有字段和内容
- **实时保存**: 检测到更改时显示保存按钮和浮动操作按钮

### 2. 字段编辑
- **基本信息**: 课程编号、标题、内容
- **词汇管理**: 添加/删除/编辑单词和含义
- **句子管理**: 添加/删除/编辑句子内容和注释
- **问题管理**: 添加/删除/编辑选择题，包括四个选项和正确答案

### 3. 编辑体验
- **变更检测**: 自动检测内容变化，显示未保存状态
- **离开提醒**: 有未保存更改时离开页面会弹出确认对话框
- **批量操作**: 支持添加和删除各类内容项
- **即时反馈**: 保存操作有明确的成功/失败提示

### 4. 数据同步
- **本地保存**: 更改先保存到本地缓存
- **数据库同步**: 提示用户使用同步功能上传到数据库
- **无缝集成**: 与课程列表页面的同步功能完全集成

## 数据管理策略

### 1. 本地优先
- 所有编辑操作首先在本地缓存中进行
- 提供快速响应和离线编辑能力
- 减少网络请求，提升用户体验

### 2. 手动同步
- 用户可控制何时同步到数据库
- 避免频繁的网络操作
- 支持批量操作后统一同步

### 3. 数据一致性
- 本地缓存与数据库分离管理
- 同步操作有明确的成功/失败反馈
- 支持双向同步，灵活应对不同场景

## 操作提示系统

### 1. 智能提示
- 删除/导入操作后提示用户同步数据库
- 同步操作完成后显示详细结果
- 错误信息清晰明确，便于问题排查

### 2. 状态反馈
- 加载状态指示器
- 操作成功/失败的视觉反馈
- 选择状态的实时显示

### 3. 用户引导
- 空状态时引导用户使用导入功能
- 多选模式的操作提示
- 同步功能的使用说明

## 技术实现

### 状态管理
```dart
bool _isMultiSelectMode = false;        // 多选模式开关
Set<int> _selectedLessonIds = <int>{};  // 选中的课程ID集合
```

### 核心方法
- `_toggleMultiSelectMode()`: 切换多选模式
- `_toggleLessonSelection()`: 切换课程选择状态
- `_selectAllLessons()`: 全选课程
- `_clearSelection()`: 清除所有选择
- `_deleteSelectedLessons()`: 批量删除
- `_exportSelectedLessons()`: 批量导出
- `_syncToDatabase()`: 上传本地数据到数据库
- `_syncFromDatabase()`: 从数据库下载数据到本地
- `_showSyncDialog()`: 显示同步选择对话框

### 数据服务方法
- `LessonManagerService.deleteLesson()`: 删除单个课程
- `LessonManagerService.deleteLessons()`: 批量删除课程
- `LessonManagerService.addLessons()`: 添加新课程
- `LessonManagerService.uploadLocalToRemote()`: 上传到远程
- `LessonManagerService.syncRemoteToLocal()`: 从远程同步

### 详情编辑页面方法
- `_saveLessonChanges()`: 保存课程更改到本地缓存
- `_onDataChanged()`: 检测数据变化，更新保存状态
- `_onWillPop()`: 处理页面离开时的未保存提醒
- `_buildBasicInfoCard()`: 构建基本信息编辑区域
- `_buildVocabularyCard()`: 构建词汇编辑区域
- `_buildSentencesCard()`: 构建句子编辑区域
- `_buildQuestionsCard()`: 构建问题编辑区域

### UI 适配
- 动态显示工具栏按钮
- 条件渲染底部操作栏
- 选中状态视觉反馈
- 响应式布局设计